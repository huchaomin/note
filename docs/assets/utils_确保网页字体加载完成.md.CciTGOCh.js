import{_ as u}from"./chunks/FenceWrapper.BY3L6E93.js";import{N as m,f as c,g as f,h as b,j as _,k as r,l as B,m as C,n as v}from"./chunks/theme.Bvy8fpr0.js";import{aa as A,Z as D,$ as a,a0 as l,R as w,u as E,ab as x,Y as L,x as i,a3 as s}from"./chunks/framework.yfsRM9mo.js";const Z=JSON.parse('{"title":"确保网页字体加载完成","description":null,"frontmatter":{"author":"peter peter@qingcongai.com","date":"2024-10-16T09:10:20.000Z","lastEditors":"peter peter@qingcongai.com","lastEditTime":"2024-12-10T10:55:29.000Z","description":null,"order":0},"headers":[],"relativePath":"utils/确保网页字体加载完成.md","filePath":"utils/确保网页字体加载完成.md"}'),M={name:"utils/确保网页字体加载完成.md"};function N(k,n,P,S,$,T){const e=B,p=m,h=u,d=c,o=f,t=b,g=C,y=v,F=_;return L(),D("div",null,[a(p,{id:"确保网页字体加载完成"},{default:l(()=>[a(e,null,{default:l(()=>n[0]||(n[0]=[i("确保网页字体加载完成")])),_:1})]),_:1}),a(h,{inCodeGroup:!1,content:`const fonts = [
  {
    isLoaded: false,
    name: 'JetBrainsMono',
  },
  {
    isLoaded: false,
    name: 'SmileySans',
  },
]

interface LoadingDoneEvent extends Event {
  fontfaces: FontFace[]
}

export default async (): Promise<void> => {
  return new Promise((resolve) => {
    document.fonts.addEventListener('loadingdone', (event: Event): void => {
      ;(event as LoadingDoneEvent).fontfaces // 网速快的话，可能返回多个，慢的话有可能只返回一个
        .map((f) => f.family)
        .forEach((name) => {
          const font = fonts.find((f) => name.includes(f.name))
          if (font) {
            font.isLoaded = true
          }
        })
      if (fonts.every((f) => f.isLoaded)) {
        resolve()
      }
    })
  })
}`},{default:l(()=>n[1]||(n[1]=[s("div",{class:"language-ts line-numbers-mode"},[s("span",{class:"lang"},"ts"),s("pre",{class:"shiki shiki-themes github-dark github-light vp-code",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#F97583","--shiki-light":"#D73A49"}},"const"),s("span",{style:{"--shiki-dark":"#79B8FF","--shiki-light":"#005CC5"}}," fonts"),s("span",{style:{"--shiki-dark":"#F97583","--shiki-light":"#D73A49"}}," ="),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}}," [")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"  {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"    isLoaded: "),s("span",{style:{"--shiki-dark":"#79B8FF","--shiki-light":"#005CC5"}},"false"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},",")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"    name: "),s("span",{style:{"--shiki-dark":"#9ECBFF","--shiki-light":"#032F62"}},"'JetBrainsMono'"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},",")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"  },")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"  {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"    isLoaded: "),s("span",{style:{"--shiki-dark":"#79B8FF","--shiki-light":"#005CC5"}},"false"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},",")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"    name: "),s("span",{style:{"--shiki-dark":"#9ECBFF","--shiki-light":"#032F62"}},"'SmileySans'"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},",")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"  },")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"]")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#F97583","--shiki-light":"#D73A49"}},"interface"),s("span",{style:{"--shiki-dark":"#B392F0","--shiki-light":"#6F42C1"}}," LoadingDoneEvent"),s("span",{style:{"--shiki-dark":"#F97583","--shiki-light":"#D73A49"}}," extends"),s("span",{style:{"--shiki-dark":"#B392F0","--shiki-light":"#6F42C1"}}," Event"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}}," {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#FFAB70","--shiki-light":"#E36209"}},"  fontfaces"),s("span",{style:{"--shiki-dark":"#F97583","--shiki-light":"#D73A49"}},":"),s("span",{style:{"--shiki-dark":"#B392F0","--shiki-light":"#6F42C1"}}," FontFace"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"[]")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"}")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#F97583","--shiki-light":"#D73A49"}},"export"),s("span",{style:{"--shiki-dark":"#F97583","--shiki-light":"#D73A49"}}," default"),s("span",{style:{"--shiki-dark":"#F97583","--shiki-light":"#D73A49"}}," async"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}}," ()"),s("span",{style:{"--shiki-dark":"#F97583","--shiki-light":"#D73A49"}},":"),s("span",{style:{"--shiki-dark":"#B392F0","--shiki-light":"#6F42C1"}}," Promise"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"<"),s("span",{style:{"--shiki-dark":"#79B8FF","--shiki-light":"#005CC5"}},"void"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"> "),s("span",{style:{"--shiki-dark":"#F97583","--shiki-light":"#D73A49"}},"=>"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}}," {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#F97583","--shiki-light":"#D73A49"}},"  return"),s("span",{style:{"--shiki-dark":"#F97583","--shiki-light":"#D73A49"}}," new"),s("span",{style:{"--shiki-dark":"#79B8FF","--shiki-light":"#005CC5"}}," Promise"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"(("),s("span",{style:{"--shiki-dark":"#FFAB70","--shiki-light":"#E36209"}},"resolve"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},") "),s("span",{style:{"--shiki-dark":"#F97583","--shiki-light":"#D73A49"}},"=>"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}}," {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"    document.fonts."),s("span",{style:{"--shiki-dark":"#B392F0","--shiki-light":"#6F42C1"}},"addEventListener"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"("),s("span",{style:{"--shiki-dark":"#9ECBFF","--shiki-light":"#032F62"}},"'loadingdone'"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},", ("),s("span",{style:{"--shiki-dark":"#FFAB70","--shiki-light":"#E36209"}},"event"),s("span",{style:{"--shiki-dark":"#F97583","--shiki-light":"#D73A49"}},":"),s("span",{style:{"--shiki-dark":"#B392F0","--shiki-light":"#6F42C1"}}," Event"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},")"),s("span",{style:{"--shiki-dark":"#F97583","--shiki-light":"#D73A49"}},":"),s("span",{style:{"--shiki-dark":"#79B8FF","--shiki-light":"#005CC5"}}," void"),s("span",{style:{"--shiki-dark":"#F97583","--shiki-light":"#D73A49"}}," =>"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}}," {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"      ;(event "),s("span",{style:{"--shiki-dark":"#F97583","--shiki-light":"#D73A49"}},"as"),s("span",{style:{"--shiki-dark":"#B392F0","--shiki-light":"#6F42C1"}}," LoadingDoneEvent"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},").fontfaces "),s("span",{style:{"--shiki-dark":"#6A737D","--shiki-light":"#6A737D"}},"// 网速快的话，可能返回多个，慢的话有可能只返回一个")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"        ."),s("span",{style:{"--shiki-dark":"#B392F0","--shiki-light":"#6F42C1"}},"map"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"(("),s("span",{style:{"--shiki-dark":"#FFAB70","--shiki-light":"#E36209"}},"f"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},") "),s("span",{style:{"--shiki-dark":"#F97583","--shiki-light":"#D73A49"}},"=>"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}}," f.family)")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"        ."),s("span",{style:{"--shiki-dark":"#B392F0","--shiki-light":"#6F42C1"}},"forEach"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"(("),s("span",{style:{"--shiki-dark":"#FFAB70","--shiki-light":"#E36209"}},"name"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},") "),s("span",{style:{"--shiki-dark":"#F97583","--shiki-light":"#D73A49"}},"=>"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}}," {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#F97583","--shiki-light":"#D73A49"}},"          const"),s("span",{style:{"--shiki-dark":"#79B8FF","--shiki-light":"#005CC5"}}," font"),s("span",{style:{"--shiki-dark":"#F97583","--shiki-light":"#D73A49"}}," ="),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}}," fonts."),s("span",{style:{"--shiki-dark":"#B392F0","--shiki-light":"#6F42C1"}},"find"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"(("),s("span",{style:{"--shiki-dark":"#FFAB70","--shiki-light":"#E36209"}},"f"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},") "),s("span",{style:{"--shiki-dark":"#F97583","--shiki-light":"#D73A49"}},"=>"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}}," name."),s("span",{style:{"--shiki-dark":"#B392F0","--shiki-light":"#6F42C1"}},"includes"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"(f.name))")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#F97583","--shiki-light":"#D73A49"}},"          if"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}}," (font) {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"            font.isLoaded "),s("span",{style:{"--shiki-dark":"#F97583","--shiki-light":"#D73A49"}},"="),s("span",{style:{"--shiki-dark":"#79B8FF","--shiki-light":"#005CC5"}}," true")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"          }")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"        })")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#F97583","--shiki-light":"#D73A49"}},"      if"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}}," (fonts."),s("span",{style:{"--shiki-dark":"#B392F0","--shiki-light":"#6F42C1"}},"every"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"(("),s("span",{style:{"--shiki-dark":"#FFAB70","--shiki-light":"#E36209"}},"f"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},") "),s("span",{style:{"--shiki-dark":"#F97583","--shiki-light":"#D73A49"}},"=>"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}}," f.isLoaded)) {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#B392F0","--shiki-light":"#6F42C1"}},"        resolve"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"()")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"      }")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"    })")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"  })")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"}")])])]),s("div",{class:"line-numbers-wrapper","aria-hidden":"true"},[s("span",{class:"line-number"},"1"),s("br"),s("span",{class:"line-number"},"2"),s("br"),s("span",{class:"line-number"},"3"),s("br"),s("span",{class:"line-number"},"4"),s("br"),s("span",{class:"line-number"},"5"),s("br"),s("span",{class:"line-number"},"6"),s("br"),s("span",{class:"line-number"},"7"),s("br"),s("span",{class:"line-number"},"8"),s("br"),s("span",{class:"line-number"},"9"),s("br"),s("span",{class:"line-number"},"10"),s("br"),s("span",{class:"line-number"},"11"),s("br"),s("span",{class:"line-number"},"12"),s("br"),s("span",{class:"line-number"},"13"),s("br"),s("span",{class:"line-number"},"14"),s("br"),s("span",{class:"line-number"},"15"),s("br"),s("span",{class:"line-number"},"16"),s("br"),s("span",{class:"line-number"},"17"),s("br"),s("span",{class:"line-number"},"18"),s("br"),s("span",{class:"line-number"},"19"),s("br"),s("span",{class:"line-number"},"20"),s("br"),s("span",{class:"line-number"},"21"),s("br"),s("span",{class:"line-number"},"22"),s("br"),s("span",{class:"line-number"},"23"),s("br"),s("span",{class:"line-number"},"24"),s("br"),s("span",{class:"line-number"},"25"),s("br"),s("span",{class:"line-number"},"26"),s("br"),s("span",{class:"line-number"},"27"),s("br"),s("span",{class:"line-number"},"28"),s("br"),s("span",{class:"line-number"},"29"),s("br"),s("span",{class:"line-number"},"30"),s("br"),s("span",{class:"line-number"},"31"),s("br"),s("span",{class:"line-number"},"32"),s("br")])],-1)])),_:1}),a(d,{style:w([{"margin-bottom":"0 !important"},{width:("isMobile"in k?k.isMobile:E(r))?"calc(100% + var(--spacing-6))":"calc(100% + var(--spacing-12))"}]),class:x(("isMobile"in k?k.isMobile:E(r))?"-mx-3":"-ml-8 -mr-3")},null,8,["class","style"]),a(o,{id:"注意"},{default:l(()=>[a(e,null,{default:l(()=>n[2]||(n[2]=[i("注意")])),_:1})]),_:1}),a(t,null,{default:l(()=>[a(e,{code:""},{default:l(()=>n[3]||(n[3]=[s("code",null,"document.fonts.ready",-1)])),_:1}),n[4]||(n[4]=i(" resolve 的时候，只保证字体已经注册，并不是已经加载完成。"))]),_:1}),a(t,null,{default:l(()=>n[5]||(n[5]=[i("网页的字体是按需加载的，有的字体暂时没用到，是不会加载的")])),_:1}),a(t,null,{default:l(()=>n[6]||(n[6]=[i("比如页面使用到了某中文字体，但是页面一个中文都没有，那个中文字体文件就不会加载。")])),_:1}),a(t,null,{default:l(()=>[n[8]||(n[8]=i("但是我们可以通过 ")),a(e,{code:""},{default:l(()=>n[7]||(n[7]=[s("code",null,"link",-1)])),_:1}),n[9]||(n[9]=i(" 标签进行预加载，比如："))]),_:1}),a(h,{inCodeGroup:!1,content:'<link as="font" crossorigin="" href="****.woff2" media="screen and (max-width: 480px)" rel="preload" type="font/woff2">'},{default:l(()=>n[10]||(n[10]=[s("div",{class:"language-html line-numbers-mode"},[s("span",{class:"lang"},"html"),s("pre",{class:"shiki shiki-themes github-dark github-light vp-code",tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"<"),s("span",{style:{"--shiki-dark":"#85E89D","--shiki-light":"#22863A"}},"link"),s("span",{style:{"--shiki-dark":"#B392F0","--shiki-light":"#6F42C1"}}," as"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"="),s("span",{style:{"--shiki-dark":"#9ECBFF","--shiki-light":"#032F62"}},'"font"'),s("span",{style:{"--shiki-dark":"#B392F0","--shiki-light":"#6F42C1"}}," crossorigin"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"="),s("span",{style:{"--shiki-dark":"#9ECBFF","--shiki-light":"#032F62"}},'""'),s("span",{style:{"--shiki-dark":"#B392F0","--shiki-light":"#6F42C1"}}," href"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"="),s("span",{style:{"--shiki-dark":"#9ECBFF","--shiki-light":"#032F62"}},'"****.woff2"'),s("span",{style:{"--shiki-dark":"#B392F0","--shiki-light":"#6F42C1"}}," media"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"="),s("span",{style:{"--shiki-dark":"#9ECBFF","--shiki-light":"#032F62"}},'"screen and (max-width: 480px)"'),s("span",{style:{"--shiki-dark":"#B392F0","--shiki-light":"#6F42C1"}}," rel"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"="),s("span",{style:{"--shiki-dark":"#9ECBFF","--shiki-light":"#032F62"}},'"preload"'),s("span",{style:{"--shiki-dark":"#B392F0","--shiki-light":"#6F42C1"}}," type"),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},"="),s("span",{style:{"--shiki-dark":"#9ECBFF","--shiki-light":"#032F62"}},'"font/woff2"'),s("span",{style:{"--shiki-dark":"#E1E4E8","--shiki-light":"#24292E"}},">")])])]),s("div",{class:"line-numbers-wrapper","aria-hidden":"true"},[s("span",{class:"line-number"},"1"),s("br")])],-1)])),_:1}),a(F,{bordered:!1,title:"警告",type:"warning"},{default:l(()=>[a(t,null,{default:l(()=>[a(y,{href:"https://www.cnblogs.com/jingdongkeji/p/17296711.html",target:"_blank",rel:"noreferrer"},{default:l(()=>[a(g,{type:"primary"},{default:l(()=>n[11]||(n[11]=[i("字体资源的加载会影响 onload")])),_:1})]),_:1}),n[14]||(n[14]=i(", 上述 ")),a(e,{code:""},{default:l(()=>n[12]||(n[12]=[s("code",null,"preload",-1)])),_:1}),n[15]||(n[15]=i(" 不会影响 ")),a(e,{code:""},{default:l(()=>n[13]||(n[13]=[s("code",null,"onload",-1)])),_:1})]),_:1})]),_:1})])}const q=A(M,[["render",N]]);export{Z as __pageData,q as default};
