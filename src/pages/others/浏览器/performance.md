---
title: 浏览器performance
---

## 获取资源加载时间

```js
performance.getEntriesByType('resource').filter(item => item.name.includes("vendor"))
```

![performance](performance.png)

### 具体解释如下

- Queueing(排队)：浏览器有连接限制，当网页资源很多时就会出现排队的现象，排队的资源要等到上一个资源加载完毕释放后才能开始请求。比关键资源(如javascript与css)低优先级的请求会被浏览器推迟，一般推迟的都是图片。在许多资源同时发起请求时浏览器默认先加载css,然后javascript，最后才是图片。
- Stalled(阻塞)：请求在发送前的时间被成为阻塞。阻塞的原因有很多种，导致排队的原因或是Proxy Negotiation都能造成阻塞。
- DNS Lookup(DNS查询)：DNS查找的时间，网页资源中请求每一个新域都需要做一次完整的DNS查询。
- Initial Connection(初次连接)：初次建立连接需要花费的时间。
- Request Sent(请求发送时间)：网络请求发送的时间。
- Waiting(TFFB)(等待时间)：等待服务器初始响应的时间。
- Content Downloading(下载时间):资源下载的时间。

### 诊断原因与解决方案

1. 排队问题

    最长见的问题就是资源排队问题。在HTTP1.0/1.1连接中，chrome最多允许对同一host一次有6个连接，如果网页种有12个资源，那后面的6个就需要排队，直到前面的下载完毕，才能按次序发起请求。解决这个问题，首先要减少网页的请求，例如css sprite、js/css压缩、采用缓存、按需加载等等。

    还有一种方法，将资源放在不同的子域名下，比如将图片资源与静态资源分开可以大大加速网页加载时间，但这个方法对HTTP2的连接不适用。

2. TFFB时间慢

    TFFB时间通常建议在200ms以下，如果超过推荐值，会引起队列中其他资源下载都跟着变慢。TFFB高主要有两个原因：一是客户端和服务器之前网络情况比较差；二是服务器应用响应比较慢。首先排除网络因素，在本地环境看一下是否仍旧存在TFFB情况，如果有，需要优化应用程序的响应时间，例如优化数据库查询、实现资源缓、修改web服务器配置等等。

    如果是由于网络引起的，那服务器与客户端的每一个节点都有可能引起这个问题，最简单的方法是把应用迁移至其他服务器看看是不是存在这个问题，然后一个节点一个节点查明原因。

3. 下载时间过久

    如果大量的时间花在下载上，那提高服务器响应也没用，还是应该将文件进行压缩。
