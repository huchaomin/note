---
date: '1641695219864'
title: utf-8 是啥
description: utf-8 的诞生和组成
tags: [utf-8]
---

### ASCII[ˈæskiː]码
计算机内部，所有信息最终都是一个二进制值

每一个二进制位（bit）有`0`和`1`两种状态，因此八个二进制位就可以组合出256种状态，这被称为一个字节
  
也就是说，一个字节一共可以用来表示256种不同的状态，每一个状态对应一个符号，就是256个符号，从`00000000`到`11111111`
上个世纪60年代，美国制定了一套字符编码，对英语字符与二进制位之间的关系，做了统一规定。这被称为 ASCII 码，一直沿用至今  

ASCII 码一共规定了128个字符的编码，比如空格`SPACE`是32（二进制`00100000`），大写的字母`A`是65（二进制`01000001`）。
这128个符号（包括32个不能打印出来的控制符号），只占用了一个字节的后面7位，**最前面的一位统一规定为`0`**
::: tip
也就是说ASCII编码只用到了一个字节能表示的一半
:::

### 非 ASCII 编码
英语用128个符号编码就够了，但是用来表示其他语言，128个符号是不够的。

#### 欧洲  
一些欧洲国家就决定，利用字节中闲置的最高位编入新的符号，例如法语中的`é`的编码为130（二进制`10000010`）
这样一来，这些欧洲国家使用的编码体系，可以表示最多256个符号

#### 其他国家  
但是，这里又出现了新的问题。不同的国家有不同的字母，因此，哪怕它们都使用256个符号的编码方式，代表的字母却不一样。比如，130在法语编码中代表了`é`，在希伯来语编码中却代表了字母`Gimel` (`ג`)，在俄语编码中又会代表另一个符号。但是不管怎样，所有这些编码方式中，0--127表示的符号是一样的，不一样的只是128--255的这一段。

#### 汉字  
汉字就多达10万左右。一个字节只能表示256种符号，肯定是不够的，就必须使用多个字节表达一个符号。比如，简体中文常见的编码方式是 GB2312，使用两个字节表示一个汉字，所以理论上最多可以表示 256 x 256 = 65536 个符号。

### Unicode

正如上一节所说，世界上存在着多种编码方式，同一个二进制数字可以被解释成不同的符号。因此，要想打开一个文本文件，就必须知道它的编码方式，否则用错误的编码方式解读，就会出现乱码。为什么电子邮件常常出现乱码？就是因为发信人和收信人使用的编码方式不一样

可以想象，如果有一种编码，将世界上所有的符号都纳入其中。每一个符号都给予一个独一无二的编码，那么乱码问题就会消失。这就是 Unicode，就像它的名字都表示的，这是一种所有符号的编码

Unicode 当然是一个很大的集合，现在的规模可以容纳100多万个符号。每个符号的编码都不一样，比如，`U+0639`表示阿拉伯字母`Ain`，`U+0041`表示英语的大写字母`A`，`U+4E25`表示汉字`严`。具体的符号对应表，可以查询[unicode.org](http://www.unicode.org/)，或者专门的[汉字对应表](http://www.chi2ko.com/tool/CJK.htm)。

> 需要注意的是，Unicode 只是一个符号集，它只规定了符号的二进制代码，却没有规定这个二进制代码应该如何存储。
>
> 比如，汉字`严`的 Unicode 是十六进制数`4E25`，转换成二进制数足足有15位（`100111000100101`），也就是说，这个符号的表示至少需要2个字节。表示其他更大的符号，可能需要3个字节或者4个字节，甚至更多。
>
> 这里就有两个严重的问题，第一个问题是，如何才能区别 Unicode 和 ASCII ？计算机怎么知道三个字节表示一个符号，而不是分别表示三个符号呢？第二个问题是，我们已经知道，英文字母只用一个字节表示就够了，如果 Unicode 统一规定，每个符号用三个或四个字节表示，那么每个英文字母前都必然有二到三个字节是`0`，这对于存储来说是极大的浪费，文本文件的大小会因此大出二三倍，这是无法接受的。
>
> 它们造成的结果是：1）出现了 Unicode 的多种存储方式，也就是说有许多种不同的二进制格式，可以用来表示 Unicode。2）Unicode 在很长一段时间内无法推广，直到互联网的出现。

### UTF-8
::: tip
UTF-8 是 Unicode 的实现方式之一
:::

UTF-8 最大的一个特点，就是它是一种长短可变的编码方式。它可以使用1~4个字节表示一个符号，根据不同的符号而变化字节长度。

规则只有两条:
- 对于单字节的符号，字节的第一位设为`0`，后面7位为这个符号的 Unicode 码。因此对于英语字母，UTF-8 编码和 ASCII 码是相同的
- 对于`n`字节的符号（`n > 1`），第一个字节的前`n`位都设为`1`，第`n + 1`位设为`0`，后面字节的前两位一律设为`10`。剩下的没有提及的二进制位，全部为这个符号的 Unicode 码。
::: table
Unicode符号范围(十六进制)|UTF-8编码方式(二进制)
0000 0000-0000 007F | 0xxxxxxx
0000 0080-0000 07FF | 110xxxxx 10xxxxxx
0000 0800-0000 FFFF | 1110xxxx 10xxxxxx 10xxxxxx
0001 0000-0010 FFFF | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx（辅助平面）
:::
> `严`的 Unicode 是4E25（二进制：100111000100101），根据上表，可以发现4E25处在第三行的范围内（0000 0800 - 0000 FFFF）  
> 因此`严`的 UTF-8 编码需要三个字节，即格式是1110xxxx 10xxxxxx 10xxxxxx。然后，从`严`的最后一个二进制位开始，依次从后向前填入格式中的x，多出的位补0。这样就得到了，`严`的 UTF-8 编码是11100100 10111000 10100101，转换成十六进制就是E4B8A5

#### 参考文献
[各个进制之间如何转换](https://www.cnblogs.com/gaizai/p/4233780.html)
[查询unicode编码](https://www.unicode.org/cgi-bin/GetUnihanData.pl?codepoint=%E8%83%A1)
[汉字与unicode对应表](http://www.chi2ko.com/tool/CJK.htm)
